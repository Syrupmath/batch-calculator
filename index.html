<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Batched Cocktail App</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>Batched Cocktail App</h1>
    </header>
    <main>
        <section id="recipe-input">
            <h2>Enter Your Recipe</h2>
            <form>
                <label for="recipe-name">Recipe Name:</label>
                <input type="text" id="recipe-name" name="recipe-name" oninput="saveValue(this)" placeholder="e.g., Manhattan">
                
                <div id="ingredients">
                    <div class="ingredient" id="ingredient-1">
                        <label for="ingredient-name-1">Ingredient:</label>
                        <input type="text" id="ingredient-name-1" name="ingredient-name-1" oninput="saveValue(this)" placeholder="e.g., Rye">
                        <label for="ingredient-quantity-1">Quantity:</label>
                        <input type="number" id="ingredient-quantity-1" name="ingredient-quantity-1" oninput="saveValue(this)" placeholder="e.g., 2">
                        <label for="ingredient-unit-1">Unit:</label>
                        <select id="ingredient-unit-1" name="ingredient-unit-1" onchange="saveValue(this)">
                            <option value="ounces">Ounces</option>
                            <option value="milliliters">Milliliters</option>
                        </select>
                        <button type="button" class="remove-ingredient" onclick="removeIngredient(this)">Remove</button>
                    </div>
                </div>
                
                <button type="button" id="add-ingredient" onclick="addIngredient()">Add Ingredient</button>
            </form>
        </section>
        
        <section id="batch-size-input">
            <h2>Batch Size</h2>
            <form>
                <label for="num-servings">Number of Servings:</label>
                <input type="number" id="num-servings" name="num-servings" oninput="saveValue(this)" placeholder="e.g., 10">
                
                <label for="total-volume">Total Volume:</label>
                <input type="number" id="total-volume" name="total-volume" oninput="saveValue(this)" placeholder="e.g., 750">
                <select id="total-volume-unit" name="total-volume-unit" onchange="saveValue(this)">
                    <option value="milliliters">Milliliters</option>
                    <option value="liters">Liters</option>
                </select>
                
                <label for="dilution">Include Dilution:</label>
                <input type="checkbox" id="dilution" name="dilution" onchange="saveValue(this)">
                
                <button type="button" id="calculate" onclick="calculateRecipe()">Calculate</button>
            </form>
        </section>
        
        <section id="output">
            <h2>Scaled Recipe</h2>
            <div id="scaled-recipe">
                <!-- Scaled recipe will be displayed here -->
            </div>
            <button type="button" id="print-recipe" onclick="window.print()">Print Recipe</button>
        </section>
    </main>
    <footer>
        <p>&copy; 2024 Batched Cocktail App</p>
    </footer>
    <script>
        // Load saved values on page load
        window.onload = function() {
            loadValues();
        };

        function addIngredient() {
            const ingredientsDiv = document.getElementById('ingredients');
            const ingredientCount = ingredientsDiv.children.length + 1;
            const newIngredient = document.createElement('div');
            newIngredient.classList.add('ingredient');
            newIngredient.id = `ingredient-${ingredientCount}`;
            newIngredient.innerHTML = `
                <label for="ingredient-name-${ingredientCount}">Ingredient:</label>
                <input type="text" id="ingredient-name-${ingredientCount}" name="ingredient-name-${ingredientCount}" oninput="saveValue(this)" placeholder="e.g., Vermouth">
                <label for="ingredient-quantity-${ingredientCount}">Quantity:</label>
                <input type="number" id="ingredient-quantity-${ingredientCount}" name="ingredient-quantity-${ingredientCount}" oninput="saveValue(this)" placeholder="e.g., 1">
                <label for="ingredient-unit-${ingredientCount}">Unit:</label>
                <select id="ingredient-unit-${ingredientCount}" name="ingredient-unit-${ingredientCount}" onchange="saveValue(this)">
                    <option value="ounces">Ounces</option>
                    <option value="milliliters">Milliliters</option>
                </select>
                <button type="button" class="remove-ingredient" onclick="removeIngredient(this)">Remove</button>
            `;
            ingredientsDiv.appendChild(newIngredient);
            saveValues();
        }

        function removeIngredient(button) {
            const ingredientDiv = button.parentElement;
            ingredientDiv.remove();
            saveValues();
        }

        function calculateRecipe() {
            let totalVolume = parseFloat(document.getElementById('total-volume').value);
            const totalVolumeUnit = document.getElementById('total-volume-unit').value;
            const includeDilution = document.getElementById('dilution').checked;

            if (totalVolumeUnit === 'liters') {
                totalVolume *= 1000; // Convert liters to milliliters
            }

            const ingredientsDiv = document.getElementById('ingredients');
            const ingredients = ingredientsDiv.getElementsByClassName('ingredient');

            let totalIngredientVolume = 0;
            let ingredientVolumes = [];

            for (let i = 0; i < ingredients.length; i++) {
                const name = ingredients[i].querySelector(`[name="ingredient-name-${i + 1}"]`).value;
                const quantity = parseFloat(ingredients[i].querySelector(`[name="ingredient-quantity-${i + 1}"]`).value) || 0;
                const unit = ingredients[i].querySelector(`[name="ingredient-unit-${i + 1}"]`).value;

                let volumeInMilliliters = convertToMilliliters(quantity, unit);
                totalIngredientVolume += volumeInMilliliters;
                ingredientVolumes.push({ name, volumeInMilliliters });
            }

            let waterVolume = 0;
            if (includeDilution) {
                const dilutionVolume = totalIngredientVolume * 0.2; // 20% of total ingredient volume
                totalIngredientVolume += dilutionVolume;
                waterVolume = dilutionVolume;
            }

            let scaledRecipe = '<h3>Scaled Recipe:</h3><ul>';

            if (totalIngredientVolume > totalVolume) {
                alert('Total volume is less than the volume of ingredients. Please increase the total volume.');
                return;
            }

            const scalingFactor = totalVolume / totalIngredientVolume;
            ingredientVolumes.forEach(ingredient => {
                let scaledQuantity = ingredient.volumeInMilliliters * scalingFactor;
                scaledRecipe += `<li>${ingredient.name}: ${convertFromMilliliters(scaledQuantity, totalVolumeUnit).toFixed(2)} ${totalVolumeUnit}</li>`;
            });

            if (includeDilution && waterVolume > 0) {
                let scaledWaterVolume = waterVolume * scalingFactor;
                scaledRecipe += `<li>Water: ${convertFromMilliliters(scaledWaterVolume, totalVolumeUnit).toFixed(2)} ${totalVolumeUnit}</li>`;
            }

            scaledRecipe += '</ul>';
            document.getElementById('scaled-recipe').innerHTML = scaledRecipe;
        }

        function convertToMilliliters(quantity, unit) {
            const conversionRates = {
                ounces: 29.5735,
                milliliters: 1,
                liters: 1000
            };
            return quantity * conversionRates[unit];
        }

        function convertFromMilliliters(quantity, unit) {
            const conversionRates = {
                ounces: 1 / 29.5735,
                milliliters: 1,
                liters: 1 / 1000
            };
            return quantity * conversionRates[unit];
        }

        // Save input values to localStorage
        function saveValue(element) {
            localStorage.setItem(element.id, element.value);
        }

        // Load input values from localStorage
        function loadValues() {
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const element = document.getElementById(key);
                if (element) {
                    element.value = localStorage.getItem(key);
                }
            }
        }

        // Save all values to localStorage
        function saveValues() {
            const inputs = document.querySelectorAll('input, select');
            inputs.forEach(input => saveValue(input));
        }
    </script>
</body>
</html>
